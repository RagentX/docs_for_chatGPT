<!DOCTYPE html>
<html>
<head>
   <title>Интеграция с Magenta</title>
   <meta name="generator" content="Help &amp; Manual" />
   <meta name="keywords" content="" />
   <meta http-equiv="Content-Type" content="text/html; charset=Windows-1251" />   
   
   <meta http-equiv="X-UA-Compatible" content="IE=edge" />
   <link type="text/css" href="default.css" rel="stylesheet" />
   <link type="text/css" href="custom.css" rel="stylesheet">

   <style TYPE="text/css" media="screen"> 
      html, body { margin:0; 
             padding:0; 
             overflow: hidden; 
             background: #FFFFFF; 
       } 

      div#printheader { display: none; }
      #idheader { width:100%; 
                  height:auto; 
                  padding: 0; 
                  margin: 0; 
       } 
      #idcontent { position:relative }                                               
      #callout-table, #overview-table {display:block; position:relative; top:0; left:0;}
      #callout-icon {display:block; position:absolute; top:-11px; left:-11px;}
      #callout-icon-flag {display:block; position:absolute; top:-11px; left:-8px;}
      #callout-table a {text-decoration: none; color: blue;}
      #callout-table a:visited {text-decoration: none; color: blue;}
      #overview-table a {text-decoration: none; color: black;}
      #overview-table a:visited {text-decoration: none; color: black;}
      #callout-table a:hover, #overview-table a:hover {text-decoration: underline;}      
      #switchtoggles { text-align: right; padding: 0 5px 0 0; font-size: 90%; margin: 0; }  
      p.help-url { margin: 20px 0 5px 0; text-align: center; font-size: 80%; text-decoration: none }
      .sync-toc { color: #ffffff; font-size: 8pt; font-weight: bold; display: none; }
      .sync-toc a { color: #ffffff; text-decoration: none; font-weight: bold;}
      .sync-toc a:visited { color: #ffffff; }
      .sync-toc a:hover { text-decoration: underline; }

   </style>
   <noscript>
   <style type="text/css">
   html, body { overflow: auto; }
   </style> 
   </noscript>
   <style type="text/css" media="print">
      span.f_Heading1 { color: black; }
      #idheader, #printheader img { display:none; }
      #printheader { display: block; margin-top: 20px; }
      #idcontent { margin-top: 10px; position:relative }
   </style>   

   <script type="text/javascript" src="jquery.js"></script>
   <script type="text/javascript" src="helpman_settings.js"></script>
   <script type="text/javascript" src="helpman_topicinit.js"></script>
   <script type="text/javascript" src="nsh.js"></script>
<!--[if lt IE 7]>
<style type="text/css">
  #idcontent {padding: 0px;} 
  #innerdiv {padding: 10px 5px 5px 10px ;} 
</style> 
<![endif]-->



</head>
<body>


<div id="printheader"><h1 class="p_Heading1"><span class="f_Heading1">Интеграция с Magenta</span></h1>
</div>
<div id="idheader">
<div id="idheaderbg">
<table style="width:100%;border:none;margin:0px;background:url(background-topic-header.jpg)" cellspacing="0" cellpadding="0"> 
  <tr valign="bottom">
    <td align="left" valign="bottom" class="topichead">
   
   <p class="crumbs" id="idnav"><b>Navigation:</b>&nbsp;
   &raquo;No topics above this level&laquo;
   </p>
   <h1 class="p_Heading1"><span class="f_Heading1">Интеграция с Magenta</span></h1>

    </td>
    <td align="right" width="120" valign="middle" class="topichead" id="idnav">
    
     <img src="hm_btn_navigate_prev_d.png" border="0"
        ><a href="debug_info.htm"
        onmouseover="document.images.main.src='hm_btn_navigate_top_orange.png'" 
        onmouseout="document.images.main.src='hm_btn_navigate_top.png'"><img name=main src="hm_btn_navigate_top.png" border=0 alt="Return to chapter overview"
        ></a><img src="hm_btn_navigate_next_d.png" border="0">
    </td>
  </tr>  
</table>
<!-- The following code displays Expand All/Collapse All links  below the header in topics containing toggles -->
   
  <p id="switchtoggles"><a href="javascript:HMToggleExpandAll(!HMAnyToggleOpen())" title="Click to open/close expanding sections">Show/Hide Hidden Text</a></p>
  
</div>
</div>  

<div id="idcontent"><div id="innerdiv">
<!--ZOOMRESTART-->
<p class="p_BodyText"><span class="f_BodyText" style="background-color: #ebf2de;">Интеграция с Magenta - задача 25144.</span></p>
<p class="p_BodyText"><span class="f_BodyText" style="background-color: #ebf2de;">Доработки интеграции - задача 26252.</span></p>
<p class="p_BodyText"><span class="f_BodyText" style="background-color: #ebf2de;">Постановка:: http:://repository/svn/debtcontrol/Documents/Технические задания/Летобанк/Magenta/Постановки/ТЗ_ПочтаБанк_Magenta_Интеграционный_слой.docx</span></p>
<p class="p_Greytoggle"><img id="TOGGLE0186A1_ICON" class="dropdown-toggle-icon" alt="Кликните, чтобы развернуть или свернуть список" title="Кликните, чтобы развернуть или свернуть список" style="margin:0;width:0.0938in;height:0.0938in;border:none" src="hmtoggle_plus1.gif"/> &nbsp; &nbsp; &nbsp; &nbsp;<span class="f_Greytoggle" style="background-color: #ebf2de;"><a class="dropdown-toggle" style="font-style: normal; font-weight: normal; color: #000000; background-color: #ebf2de; text-decoration: none;" title="Кликните, чтобы развернуть или свернуть список" href="javascript:HMToggle('toggle','TOGGLE0186A1','TOGGLE0186A1_ICON')">Далее на этой странице</a></span></p>
<div id="TOGGLE0186A1" class="dropdown-toggle-body" style="text-align: justify; text-indent: 0.2500in; line-height: 1.32; padding: 0 0 0 0; margin: 0.0521in 0 0.0417in 0;"><table style="border:none; border-spacing:0;">
<tr>
<td style="vertical-align:top; padding:0; border:none"><p class="p_Маркированныйузкий2" style="text-indent: 0; padding-left: 0.9583in; margin-left: 0.2500in;"><span style="display:inline-block;width:0.2396in;margin-left:-0.2396in;font-size:10pt;font-family:'Symbol';font-style:normal;color:#000000;text-decoration:none;">&#183;</span><span class="f_Маркированныйузкий2" style="background-color: #ebf2de;">1.&nbsp;<a href="leto_magenta_base.htm#1" class="topiclink">Общее описание интеграции Magenta</a>;</span></p><p class="p_Маркированныйузкий2" style="text-indent: 0; padding-left: 0.9583in; margin-left: 0.2500in;"><span style="display:inline-block;width:0.2396in;margin-left:-0.2396in;font-size:10pt;font-family:'Symbol';font-style:normal;color:#000000;text-decoration:none;">&#183;</span><span class="f_Маркированныйузкий2" style="background-color: #ebf2de;">2.&nbsp;<a href="leto_magenta_base.htm#2" class="topiclink">Виды процедур для передачи информации</a>:</span></p><p class="p_Маркированныйузкий2" style="text-indent: 0; padding-left: 1.4375in; margin-left: 0.2500in;"><span style="display:inline-block;width:0.2396in;margin-left:-0.2396in;font-size:10pt;font-family:'Wingdings';font-style:normal;color:#000000;text-decoration:none;">&#167;</span><span class="f_Маркированныйузкий2" style="background-color: #ebf2de;">2.1.&nbsp;<a href="leto_magenta_base.htm#2.1" class="topiclink">Процедура экспорта (асинхронный запрос)</a>;</span></p><p class="p_Маркированныйузкий2" style="text-indent: 0; padding-left: 1.4375in; margin-left: 0.2500in;"><span style="display:inline-block;width:0.2396in;margin-left:-0.2396in;font-size:10pt;font-family:'Wingdings';font-style:normal;color:#000000;text-decoration:none;">&#167;</span><span class="f_Маркированныйузкий2" style="background-color: #ebf2de;">2.2.&nbsp;<a href="leto_magenta_base.htm#2.2" class="topiclink">Список REST-запросов по экспорту данных в Magenta</a>:</span></p><p class="p_Маркированныйузкий2" style="text-indent: 0; padding-left: 1.6771in; margin-left: 0.2500in;"><span style="display:inline-block;width:0.2396in;margin-left:-0.2396in;font-size:10pt;font-family:'Symbol';font-style:normal;color:#000000;text-decoration:none;">&#183;</span><span class="f_Маркированныйузкий2" style="background-color: #ebf2de;">2.2.1.&nbsp;<a href="leto_magenta_base.htm#2.2.1" class="topiclink">Адреса</a>;</span></p><p class="p_Маркированныйузкий2" style="text-indent: 0; padding-left: 1.6771in; margin-left: 0.2500in;"><span style="display:inline-block;width:0.2396in;margin-left:-0.2396in;font-size:10pt;font-family:'Symbol';font-style:normal;color:#000000;text-decoration:none;">&#183;</span><span class="f_Маркированныйузкий2" style="background-color: #ebf2de;">2.2.2.&nbsp;<a href="leto_magenta_base.htm#2.2.2" class="topiclink">Клиентская информация и телефоны</a>;</span></p><p class="p_Маркированныйузкий2" style="text-indent: 0; padding-left: 1.6771in; margin-left: 0.2500in;"><span style="display:inline-block;width:0.2396in;margin-left:-0.2396in;font-size:10pt;font-family:'Symbol';font-style:normal;color:#000000;text-decoration:none;">&#183;</span><span class="f_Маркированныйузкий2" style="background-color: #ebf2de;">2.2.3.&nbsp;<a href="leto_magenta_base.htm#2.2.3" class="topiclink">Договоры и финансовая информация</a>;</span></p><p class="p_Маркированныйузкий2" style="text-indent: 0; padding-left: 1.6771in; margin-left: 0.2500in;"><span style="display:inline-block;width:0.2396in;margin-left:-0.2396in;font-size:10pt;font-family:'Symbol';font-style:normal;color:#000000;text-decoration:none;">&#183;</span><span class="f_Маркированныйузкий2" style="background-color: #ebf2de;">2.2.4.&nbsp;<a href="leto_magenta_base.htm#2.2.4" class="topiclink">Импорт задач</a>;</span></p><p class="p_Маркированныйузкий2" style="text-indent: 0; padding-left: 1.6771in; margin-left: 0.2500in;"><span style="display:inline-block;width:0.2396in;margin-left:-0.2396in;font-size:10pt;font-family:'Symbol';font-style:normal;color:#000000;text-decoration:none;">&#183;</span><span class="f_Маркированныйузкий2" style="background-color: #ebf2de;">2.2.5.&nbsp;<a href="leto_magenta_base.htm#2.2.5" class="topiclink">Импорт истории коммуникации</a>;</span></p><p class="p_Маркированныйузкий2" style="text-indent: 0; padding-left: 1.6771in; margin-left: 0.2500in;"><span style="display:inline-block;width:0.2396in;margin-left:-0.2396in;font-size:10pt;font-family:'Symbol';font-style:normal;color:#000000;text-decoration:none;">&#183;</span><span class="f_Маркированныйузкий2" style="background-color: #ebf2de;">2.2.6.&nbsp;<a href="leto_magenta_base.htm#2.2.6" class="topiclink">Отмена задач и удаление клиентов</a>;</span></p><p class="p_Маркированныйузкий2" style="text-indent: 0; padding-left: 1.4375in; margin-left: 0.2500in;"><span style="display:inline-block;width:0.2396in;margin-left:-0.2396in;font-size:10pt;font-family:'Wingdings';font-style:normal;color:#000000;text-decoration:none;">&#167;</span><span class="f_Маркированныйузкий2" style="background-color: #ebf2de;">2.3.&nbsp;<a href="leto_magenta_base.htm#2.3" class="topiclink">Процедура запроса результатов загрузки по токену</a>;</span></p><p class="p_Маркированныйузкий2" style="text-indent: 0; padding-left: 1.4375in; margin-left: 0.2500in;"><span style="display:inline-block;width:0.2396in;margin-left:-0.2396in;font-size:10pt;font-family:'Wingdings';font-style:normal;color:#000000;text-decoration:none;">&#167;</span><span class="f_Маркированныйузкий2" style="background-color: #ebf2de;">2.4.&nbsp;<a href="leto_magenta_base.htm#2.4" class="topiclink">Процедура импорта (синхронный запрос)</a>;</span></p><p class="p_Маркированныйузкий2" style="text-indent: 0; padding-left: 1.4375in; margin-left: 0.2500in;"><span style="display:inline-block;width:0.2396in;margin-left:-0.2396in;font-size:10pt;font-family:'Wingdings';font-style:normal;color:#000000;text-decoration:none;">&#167;</span><span class="f_Маркированныйузкий2" style="background-color: #ebf2de;">2.5.&nbsp;<a href="leto_magenta_base.htm#2.5" class="topiclink">Список REST-запросов по импорту данных из Magenta</a>:</span></p><p class="p_Маркированныйузкий2" style="text-indent: 0; padding-left: 1.6771in; margin-left: 0.2500in;"><span style="display:inline-block;width:0.2396in;margin-left:-0.2396in;font-size:10pt;font-family:'Symbol';font-style:normal;color:#000000;text-decoration:none;">&#183;</span><span class="f_Маркированныйузкий2" style="background-color: #ebf2de;">2.5.1.&nbsp;<a href="leto_magenta_base.htm#2.5.1" class="topiclink">Результат геокодирования</a>;</span></p><p class="p_Маркированныйузкий2" style="text-indent: 0; padding-left: 1.6771in; margin-left: 0.2500in;"><span style="display:inline-block;width:0.2396in;margin-left:-0.2396in;font-size:10pt;font-family:'Symbol';font-style:normal;color:#000000;text-decoration:none;">&#183;</span><span class="f_Маркированныйузкий2" style="background-color: #ebf2de;">2.5.2.&nbsp;<a href="leto_magenta_base.htm#2.5.2" class="topiclink">Результаты выполнения задач</a>;</span></p><p class="p_Маркированныйузкий2" style="text-indent: 0; padding-left: 1.6771in; margin-left: 0.2500in;"><span style="display:inline-block;width:0.2396in;margin-left:-0.2396in;font-size:10pt;font-family:'Symbol';font-style:normal;color:#000000;text-decoration:none;">&#183;</span><span class="f_Маркированныйузкий2" style="background-color: #ebf2de;">2.5.3.&nbsp;<a href="leto_magenta_base.htm#2.5.3" class="topiclink">Экспорт полигонов</a>;</span></p><p class="p_Маркированныйузкий2" style="text-indent: 0; padding-left: 1.4375in; margin-left: 0.2500in;"><span style="display:inline-block;width:0.2396in;margin-left:-0.2396in;font-size:10pt;font-family:'Wingdings';font-style:normal;color:#000000;text-decoration:none;">&#167;</span><span class="f_Маркированныйузкий2" style="background-color: #ebf2de;">2.6.&nbsp;<a href="leto_magenta_base.htm#2.6" class="topiclink">Ежедневная плановая интеграция</a>;</span></p><p class="p_Маркированныйузкий2" style="text-indent: 0; padding-left: 0.9583in; margin-left: 0.2500in;"><span style="display:inline-block;width:0.2396in;margin-left:-0.2396in;font-size:10pt;font-family:'Symbol';font-style:normal;color:#000000;text-decoration:none;">&#183;</span><span class="f_Маркированныйузкий2" style="background-color: #ebf2de;">3.&nbsp;<a href="leto_magenta_base.htm#3" class="topiclink">Требование к данным и их формату</a>;</span></p><p class="p_Маркированныйузкий2" style="text-indent: 0; padding-left: 0.9583in; margin-left: 0.2500in;"><span style="display:inline-block;width:0.2396in;margin-left:-0.2396in;font-size:10pt;font-family:'Symbol';font-style:normal;color:#000000;text-decoration:none;">&#183;</span><span class="f_Маркированныйузкий2" style="background-color: #ebf2de;">4.&nbsp;<a href="leto_magenta_base.htm#4" class="topiclink">Доработка интеграции с Magenta</a>.</span></p></td>
</tr>
</table>
</div>
<p class="p_heading5" style="page-break-after: avoid;"><a name="1" class="hmanchor"></a><span class="f_heading5" style="background-color: #ebf2de;">1. Общее описание интеграции с Magenta</span></p>
<p class="p_BodyText"><span class="f_BodyText" style="background-color: #ebf2de;">Осуществляется интеграция Коллекторской системы &quot;Контакт&quot; с системой &quot;Мобильный сбор&quot; Magenta (далее — Magenta). Данная система служит для поддержки процесса взыскания задолженности путем выездного сбора. В рамках интеграции за Системы в Magenta должны передаваться должники с контактной информацией, их активные договора, а также задачи на выезд.&nbsp;</span></p>
<p style="text-indent: -0.2500in; page-break-after: avoid; margin: 0.1667in 0 0.0833in 0.2500in;"><a name="2" class="hmanchor"></a><span class="f_heading5" style="background-color: #ebf2de;">2. Виды процедур для передачи информации</span></p>
<p class="p_BodyText"><span class="f_BodyText" style="background-color: #ebf2de;">Интеграция состоит из вызова следующих видов процедур.</span></p>
<p class="p_heading6" style="page-break-after: avoid;"><a name="2.1" class="hmanchor"></a><span class="f_heading6" style="background-color: #ebf2de;">2.1. Процедура экспорта (асинхронный запрос)</span></p>
<p class="p_BodyText"><span class="f_BodyText" style="background-color: #ebf2de;">Контакт при необходимости передать информацию обращается с асинхронным запросом к REST API Magenta.</span></p>
<p class="p_BodyText"><span class="f_BodyText" style="background-color: #ebf2de;">REST API выполняет запрос и в ответном сообщении возвращает токен в Контакт, по которому можно в дальнейшем запрашивать статус загрузки данных.</span></p>
<p class="p_BodyText"><span class="f_BodyText" style="background-color: #ebf2de;">Схема процедуры экспорта:</span></p>
<p class="p_caption"><a class="imagetogglelink" style="margin:0;width:7.1146in;height:3.6667in" href="magenta_01.png"><img id="TOGGLE0186A2" class="image-toggle" alt="magenta_01_zoom50" style="border:none;width:7.1146in;height:3.6667in" src="magenta_01_zoom50.png"/><svg class="image-toggle-magnifier" viewBox="0 0 24 24"><path d="M 9.145 18.29 c -5.042 0 -9.145 -4.102 -9.145 -9.145 s 4.103 -9.145 9.145 -9.145 s 9.145 4.103 9.145 9.145 s -4.102 9.145 -9.145 9.145 Z m 0 -15.167 c -3.321 0 -6.022 2.702 -6.022 6.022 s 2.702 6.022 6.022 6.022 s 6.023 -2.702 6.023 -6.022 s -2.702 -6.022 -6.023 -6.022 Z m 9.263 12.443 c -0.817 1.176 -1.852 2.188 -3.046 2.981 l 5.452 5.453 l 3.014 -3.013 l -5.42 -5.421 Z"></path></svg></a></p>
<p class="p_heading6" style="page-break-after: avoid;"><a name="2.2" class="hmanchor"></a><span class="f_heading6" style="background-color: #ebf2de;">2.2. Список REST-запросов по экспорту данных в Magenta</span></p>
<p class="p_heading8" style="page-break-inside: avoid; page-break-after: avoid;"><a name="2.2.1" class="hmanchor"></a><span class="f_heading8" style="background-color: #ebf2de;">2.2.1. Адреса</span></p>
<p class="p_BodyText"><span class="f_Кнопка" style="background-color: #ebf2de;">Имя процедуры</span><span class="f_BodyText" style="background-color: #ebf2de;">: UR_MAGENTA_POCHTA.export_address</span></p>
<p class="p_BodyText"><span class="f_BodyText" style="background-color: #ebf2de;">В данном потоке из Контакта в Мобильный сбор передаются адреса для выполнения процедуры геокодирования.</span></p>
<p class="p_BodyText"><span class="f_BodyText" style="background-color: #ebf2de;">Адреса, переданные в этом потоке, проходят процедуру определения географических координат.</span></p>
<p class="p_heading8" style="page-break-inside: avoid; page-break-after: avoid;"><a name="2.2.2" class="hmanchor"></a><span class="f_heading8" style="background-color: #ebf2de;">2.2.2. Клиентская информация и телефоны</span></p>
<p class="p_BodyText"><span class="f_Кнопка" style="background-color: #ebf2de;">Имя процедуры</span><span class="f_BodyText" style="background-color: #ebf2de;">: UR_MAGENTA_POCHTA.export_person</span></p>
<p class="p_BodyText"><span class="f_BodyText" style="background-color: #ebf2de;">В данном потоке передаются информация о клиентах и связанная с ними информация о телефонах.</span></p>
<p class="p_heading8" style="page-break-inside: avoid; page-break-after: avoid;"><a name="2.2.3" class="hmanchor"></a><span class="f_heading8" style="background-color: #ebf2de;">2.2.3. Договоры и финансовая информация</span></p>
<p class="p_BodyText"><span class="f_Кнопка" style="background-color: #ebf2de;">Имя процедуры</span><span class="f_BodyText" style="background-color: #ebf2de;">: UR_MAGENTA_POCHTA.export_debt</span></p>
<p class="p_BodyText"><span class="f_BodyText" style="background-color: #ebf2de;">В данном потоке передается информация о договорах и связанная с ними информация о платежах, графике платежей, портфеле, юридическом производстве.</span></p>
<p class="p_heading8" style="page-break-inside: avoid; page-break-after: avoid;"><a name="2.2.4" class="hmanchor"></a><span class="f_heading8" style="background-color: #ebf2de;">2.2.4. Импорт задач</span></p>
<p class="p_BodyText"><span class="f_Кнопка" style="background-color: #ebf2de;">Имя процедуры</span><span class="f_BodyText" style="background-color: #ebf2de;">: UR_MAGENTA_POCHTA.export_task</span></p>
<p class="p_BodyText"><span class="f_BodyText" style="background-color: #ebf2de;">В этом потоке передаются все задачи на выполнение, как выезды, звонки, так и прочие задачи.</span></p>
<p class="p_heading8" style="page-break-inside: avoid; page-break-after: avoid;"><a name="2.2.5" class="hmanchor"></a><span class="f_heading8" style="background-color: #ebf2de;">2.2.5. Импорт истории коммуникации</span></p>
<p class="p_BodyText"><span class="f_Кнопка" style="background-color: #ebf2de;">Имя процедуры</span><span class="f_BodyText" style="background-color: #ebf2de;">: UR_MAGENTA_POCHTA.export_contact_log</span></p>
<p class="p_BodyText"><span class="f_BodyText" style="background-color: #ebf2de;">В этом потоке передаются все истории коммуникаций.</span></p>
<p class="p_heading8" style="page-break-inside: avoid; page-break-after: avoid;"><a name="2.2.6" class="hmanchor"></a><span class="f_heading8" style="background-color: #ebf2de;">2.2.6. Отмена задач и удаление клиентов</span></p>
<p class="p_BodyText"><span class="f_Кнопка" style="background-color: #ebf2de;">Имя процедуры</span><span class="f_BodyText" style="background-color: #ebf2de;">: UR_MAGENTA_POCHTA.cancel_task</span></p>
<p class="p_BodyText"><span class="f_BodyText" style="background-color: #ebf2de;">В данном потоке Мобильный сбор будет принимать информацию о задачах, которые следует отменить и о клиентах, по которым больше не будет вестись работа.</span></p>
<p class="p_BodyText"><span class="f_Кнопка" style="background-color: #ebf2de;">Примечание</span><span class="f_BodyText" style="background-color: #ebf2de;">: Данная процедура не будет вызываться при ежедневном плановом обмене данными. Будет вызваться при выполнении действия &quot;Отменить задачи на выезд&quot; в ГСП. Предусмотреть передачу списка задач на вход процедуры.</span></p>
<p class="p_BodyText"><span class="f_BodyText" style="background-color: #ebf2de;">Схема отмены задач на выезд:</span></p>
<p class="p_caption"><a class="imagetogglelink" style="margin:0;width:6.9479in;height:3.7188in" href="magenta_02.png"><img id="TOGGLE0186A3" class="image-toggle" alt="magenta_02_zoom50" style="border:none;width:6.9479in;height:3.7188in" src="magenta_02_zoom50.png"/><svg class="image-toggle-magnifier" viewBox="0 0 24 24"><path d="M 9.145 18.29 c -5.042 0 -9.145 -4.102 -9.145 -9.145 s 4.103 -9.145 9.145 -9.145 s 9.145 4.103 9.145 9.145 s -4.102 9.145 -9.145 9.145 Z m 0 -15.167 c -3.321 0 -6.022 2.702 -6.022 6.022 s 2.702 6.022 6.022 6.022 s 6.023 -2.702 6.023 -6.022 s -2.702 -6.022 -6.023 -6.022 Z m 9.263 12.443 c -0.817 1.176 -1.852 2.188 -3.046 2.981 l 5.452 5.453 l 3.014 -3.013 l -5.42 -5.421 Z"></path></svg></a></p>
<p class="p_heading6" style="page-break-after: avoid;"><a name="2.3" class="hmanchor"></a><span class="f_heading6" style="background-color: #ebf2de;">2.3. Процедура запроса результатов загрузки по токену</span></p>
<p class="p_BodyText"><span class="f_Кнопка" style="background-color: #ebf2de;">Имя процедуры</span><span class="f_BodyText" style="background-color: #ebf2de;">: UR_MAGENTA_POCHTA.request_load_result</span></p>
<p class="p_BodyText"><span class="f_BodyText" style="background-color: #ebf2de;">Запрос результатов загрузки по токенам реализован в виде нового фонового задания (джоба). Джоб вызывает процедуру UR_MAGENTA_POCHTA.request_load_result с интервалом 5 минут.</span></p>
<p class="p_BodyText"><span class="f_BodyText" style="background-color: #ebf2de;">Схема запроса статуса загрузки по токену:</span></p>
<p class="p_caption"><a class="imagetogglelink" style="margin:0;width:6.6667in;height:4.3958in" href="magenta_03.png"><img id="TOGGLE0186A4" class="image-toggle" alt="magenta_03_zoom50" style="border:none;width:6.6667in;height:4.3958in" src="magenta_03_zoom50.png"/><svg class="image-toggle-magnifier" viewBox="0 0 24 24"><path d="M 9.145 18.29 c -5.042 0 -9.145 -4.102 -9.145 -9.145 s 4.103 -9.145 9.145 -9.145 s 9.145 4.103 9.145 9.145 s -4.102 9.145 -9.145 9.145 Z m 0 -15.167 c -3.321 0 -6.022 2.702 -6.022 6.022 s 2.702 6.022 6.022 6.022 s 6.023 -2.702 6.023 -6.022 s -2.702 -6.022 -6.023 -6.022 Z m 9.263 12.443 c -0.817 1.176 -1.852 2.188 -3.046 2.981 l 5.452 5.453 l 3.014 -3.013 l -5.42 -5.421 Z"></path></svg></a></p>
<p class="p_heading6" style="page-break-after: avoid;"><a name="2.4" class="hmanchor"></a><span class="f_heading6" style="background-color: #ebf2de;">2.4. Процедура импорта (синхронный запрос)</span></p>
<p class="p_BodyText"><span class="f_BodyText" style="background-color: #ebf2de;">Контакт при необходимости получить информацию обращается с синхронным запросом к REST API Magenta.</span></p>
<p class="p_BodyText"><span class="f_BodyText" style="background-color: #ebf2de;">REST API выполняет запрос и сразу в ответном сообщении возвращает его результаты в Контакт.</span></p>
<p class="p_BodyText"><span class="f_BodyText" style="background-color: #ebf2de;">Схема импорта данных из Magenta:</span></p>
<p class="p_caption"><a class="imagetogglelink" style="margin:0;width:6.9167in;height:3.7604in" href="magenta_04.png"><img id="TOGGLE0186A5" class="image-toggle" alt="magenta_04_zoom50" style="border:none;width:6.9167in;height:3.7604in" src="magenta_04_zoom50.png"/><svg class="image-toggle-magnifier" viewBox="0 0 24 24"><path d="M 9.145 18.29 c -5.042 0 -9.145 -4.102 -9.145 -9.145 s 4.103 -9.145 9.145 -9.145 s 9.145 4.103 9.145 9.145 s -4.102 9.145 -9.145 9.145 Z m 0 -15.167 c -3.321 0 -6.022 2.702 -6.022 6.022 s 2.702 6.022 6.022 6.022 s 6.023 -2.702 6.023 -6.022 s -2.702 -6.022 -6.023 -6.022 Z m 9.263 12.443 c -0.817 1.176 -1.852 2.188 -3.046 2.981 l 5.452 5.453 l 3.014 -3.013 l -5.42 -5.421 Z"></path></svg></a></p>
<p class="p_heading6" style="page-break-after: avoid;"><a name="2.5" class="hmanchor"></a><span class="f_heading6" style="background-color: #ebf2de;">2.5. Список REST-запросов по импорту данных из Magenta</span></p>
<p class="p_heading8" style="page-break-inside: avoid; page-break-after: avoid;"><a name="2.5.1" class="hmanchor"></a><span class="f_heading8" style="background-color: #ebf2de;">2.5.1. Результат геокодирования</span></p>
<p class="p_BodyText"><span class="f_Кнопка" style="background-color: #ebf2de;">Имя процедуры</span><span class="f_BodyText" style="background-color: #ebf2de;">: UR_MAGENTA_POCHTA.import_address_geo.</span></p>
<p class="p_BodyText"><span class="f_BodyText" style="background-color: #ebf2de;">Схема работы запроса результата геокодирования:</span></p>
<p class="p_caption"><a class="imagetogglelink" style="margin:0;width:5.3750in;height:2.0208in" href="magenta_05.png"><img id="TOGGLE0186A6" class="image-toggle" alt="magenta_05_zoom50" style="border:none;width:5.3750in;height:2.0208in" src="magenta_05_zoom50.png"/><svg class="image-toggle-magnifier" viewBox="0 0 24 24"><path d="M 9.145 18.29 c -5.042 0 -9.145 -4.102 -9.145 -9.145 s 4.103 -9.145 9.145 -9.145 s 9.145 4.103 9.145 9.145 s -4.102 9.145 -9.145 9.145 Z m 0 -15.167 c -3.321 0 -6.022 2.702 -6.022 6.022 s 2.702 6.022 6.022 6.022 s 6.023 -2.702 6.023 -6.022 s -2.702 -6.022 -6.023 -6.022 Z m 9.263 12.443 c -0.817 1.176 -1.852 2.188 -3.046 2.981 l 5.452 5.453 l 3.014 -3.013 l -5.42 -5.421 Z"></path></svg></a></p>
<p class="p_heading8" style="page-break-inside: avoid; page-break-after: avoid;"><a name="2.5.2" class="hmanchor"></a><span class="f_heading8" style="background-color: #ebf2de;">2.5.2. Результаты выполнения задач</span></p>
<p class="p_BodyText"><span class="f_Кнопка" style="background-color: #ebf2de;">Имя процедуры</span><span class="f_BodyText" style="background-color: #ebf2de;">: UR_MAGENTA_POCHTA.import_task_result</span></p>
<p class="p_heading8" style="page-break-inside: avoid; page-break-after: avoid;"><a name="2.5.3" class="hmanchor"></a><span class="f_heading8" style="background-color: #ebf2de;">2.5.3. Экспорт полигонов</span></p>
<p class="p_BodyText"><span class="f_Кнопка" style="background-color: #ebf2de;">Имя процедуры</span><span class="f_BodyText" style="background-color: #ebf2de;">: UR_MAGENTA_POCHTA.import_address_polygon</span></p>
<p class="p_BodyText"><span class="f_BodyText" style="background-color: #ebf2de;">В ответ на запрос должна вернуться информация о связи полигонов и сотрудников (водителей), стартовая точка маршрута которых (задаётся в свойствах водителя в системе Мобильный Сбор) находится внутри.</span></p>
<p class="p_heading6" style="page-break-after: avoid;"><a name="2.6" class="hmanchor"></a><span class="f_heading6" style="background-color: #ebf2de;">2.6. Ежедневная плановая интеграция</span></p>
<p class="p_BodyText"><span class="f_BodyText" style="background-color: #ebf2de;">Ежедневная интеграция должна начинаться после окончания дневного ETL.</span></p>
<p class="p_BodyText"><span class="f_BodyText" style="background-color: #ebf2de;">Вызываются все описанные в документе запросы последовательно, за исключением запроса &quot;Отмена задач и удаление клиентов&quot;.</span></p>
<p class="p_BodyText"><span class="f_BodyText" style="background-color: #ebf2de;">Схема ежедневной плановой интеграции:</span></p>
<p class="p_caption"><a class="imagetogglelink" style="margin:0;width:5.1979in;height:2.4583in" href="magenta_06.png"><img id="TOGGLE0186A7" class="image-toggle" alt="magenta_06_zoom50" style="border:none;width:5.1979in;height:2.4583in" src="magenta_06_zoom50.png"/><svg class="image-toggle-magnifier" viewBox="0 0 24 24"><path d="M 9.145 18.29 c -5.042 0 -9.145 -4.102 -9.145 -9.145 s 4.103 -9.145 9.145 -9.145 s 9.145 4.103 9.145 9.145 s -4.102 9.145 -9.145 9.145 Z m 0 -15.167 c -3.321 0 -6.022 2.702 -6.022 6.022 s 2.702 6.022 6.022 6.022 s 6.023 -2.702 6.023 -6.022 s -2.702 -6.022 -6.023 -6.022 Z m 9.263 12.443 c -0.817 1.176 -1.852 2.188 -3.046 2.981 l 5.452 5.453 l 3.014 -3.013 l -5.42 -5.421 Z"></path></svg></a></p>
<p style="text-indent: -0.2500in; page-break-after: avoid; margin: 0.1667in 0 0.0833in 0.2500in;"><a name="3" class="hmanchor"></a><span class="f_heading5" style="background-color: #ebf2de;">3. Требование к данным и их формату</span></p>
<p class="p_ListBullet2" style="text-indent: 0; padding-left: 0.2396in; margin-left: 0.2500in;"><span style="display:inline-block;width:0.2396in;margin-left:-0.2396in;font-size:10pt;font-family:'Symbol';font-style:normal;color:#000000;text-decoration:none;">&#183;</span><span class="f_ListBullet2" style="background-color: #ebf2de;">Даты передаются в формате &quot;ГГГГ-ММ-ДД&quot;, где &quot;ГГГГ&quot; – год, &quot;ММ&quot; – месяц, &quot;ДД&quot; – день, например, &quot;2016-12-31&quot;.</span></p><p class="p_ListBullet2" style="text-indent: 0; padding-left: 0.2396in; margin-left: 0.2500in;"><span style="display:inline-block;width:0.2396in;margin-left:-0.2396in;font-size:10pt;font-family:'Symbol';font-style:normal;color:#000000;text-decoration:none;">&#183;</span><span class="f_ListBullet2" style="background-color: #ebf2de;">Время передается в формате &quot;чч:мм:сс&quot;, где &quot;чч&quot; - часы, &quot;мм&quot; - минуты, &quot;сс&quot; - секунды, например, &quot;23:46:15&quot;.</span></p><p class="p_ListBullet2" style="text-indent: 0; padding-left: 0.2396in; margin-left: 0.2500in;"><span style="display:inline-block;width:0.2396in;margin-left:-0.2396in;font-size:10pt;font-family:'Symbol';font-style:normal;color:#000000;text-decoration:none;">&#183;</span><span class="f_ListBullet2" style="background-color: #ebf2de;">Поля с датой и временем передаются в формате &quot;ГГГГ-ММ-ДД&quot;+Т+ &quot;чч:мм::сс&quot;, например, &quot;2016-12-31T23:55:56&quot;.</span></p><p class="p_ListBullet2" style="text-indent: 0; padding-left: 0.2396in; margin-left: 0.2500in;"><span style="display:inline-block;width:0.2396in;margin-left:-0.2396in;font-size:10pt;font-family:'Symbol';font-style:normal;color:#000000;text-decoration:none;">&#183;</span><span class="f_ListBullet2" style="background-color: #ebf2de;">Все данные о времени (или о дате и времени) должны передаваться в формате UTC.</span></p><p class="p_ListBullet2" style="text-indent: 0; padding-left: 0.2396in; margin-left: 0.2500in;"><span style="display:inline-block;width:0.2396in;margin-left:-0.2396in;font-size:10pt;font-family:'Symbol';font-style:normal;color:#000000;text-decoration:none;">&#183;</span><span class="f_ListBullet2" style="background-color: #ebf2de;">Если в запросе поле-источник пустое, то требуется передавать пустой тег. Например:</span></p><p style="text-align: justify; text-indent: 0; padding-left: 0.2500in; margin: 0.0417in 0 0.0833in 0.2500in;"><span style="display:inline-block;width:0.2500in;margin-left:-0.2500in;font-size:10pt;font-family:'Symbol';font-style:normal;color:#000080;text-decoration:none;">&#189;</span><span class="f_quote_my" style="background-color: #ebf2de;">&lt;longitude/&gt; или &lt;longitude&gt;&lt;/longitude&gt;.</span></p><p class="p_BodyText"><span class="f_BodyText" style="background-color: #ebf2de;">Данные, описанные далее в интеграционных запросах, и содержащие ссылки на справочники, не ограничены текущими значениями справочников, и приведены для примера содержания передаваемых данных. Справочники не являются автоматически синхронизируемой сущностью. Передаваемые данные, ссылающиеся на справочники, должны содержать строковые значения, соответствующие содержательной части справочников, а не идентификаторам или другим условным кодам.</span></p>
<p class="p_heading5" style="page-break-after: avoid;"><a name="4" class="hmanchor"></a><span class="f_heading5" style="background-color: #ebf2de;">4. Доработка интеграции с Magenta</span></p>
<p class="p_ListNumber" style="text-indent: 0; padding-left: 0.2500in; margin-left: 0;"><span class="f_ListNumber" style="display:inline-block;width:0.2500in;margin-left:-0.2500in">1.</span><span class="f_ListNumber" style="background-color: #ebf2de;">Изменена логика отбора адресов для передачи в Мадженту (как для всех адресов, так и для адресов в отдельной таблице - для каждого своя логика). См. пункт &quot;Адреса&quot; в ТЗ: http://repository/svn/debtcontrol/Documents/Технические задания/Летобанк/Magenta/ТЗ на интеграцию с Magenta.DOCX</span></p><p class="p_ListNumber" style="text-indent: 0; padding-left: 0.2500in; margin-left: 0;"><span class="f_ListNumber" style="display:inline-block;width:0.2500in;margin-left:-0.2500in">2.</span><span class="f_ListNumber" style="background-color: #ebf2de;">При получении геокоординат от Мадженты в таблице address_geo в поле external_origin_id требуется проставлять 1</span></p><p class="p_ListNumber" style="text-indent: 0; padding-left: 0.2500in; margin-left: 0;"><span class="f_ListNumber" style="display:inline-block;width:0.2500in;margin-left:-0.2500in">3.</span><span class="f_ListNumber" style="background-color: #ebf2de;">Экспорт и импорт поменять местами: 1-ым шагом мы должны забрать данные из Мадженты, 2-ым шагом передать в нее новые данные.</span></p>
<!--ZOOMSTOP-->
</div></div>
<script type="text/javascript">

var lastSlashPos = document.URL.lastIndexOf("/") > document.URL.lastIndexOf("\\") ? document.URL.lastIndexOf("/") : document.URL.lastIndexOf("\\");
if( document.URL.substring(lastSlashPos + 1, lastSlashPos + 4).toLowerCase() != "~hh" )
{
 if (document.all) setTimeout(function() {nsrInit();},20); 
    else nsrInit();
 } 


</script>
<script type="text/javascript">
if (window.topicInitScriptAvailable) {
function HMInitToggleStates() {
HMInitToggle('TOGGLE0186A1_ICON','hm.type','dropdown','hm.state','0','hm.src0','hmtoggle_plus0.gif','hm.src1','hmtoggle_plus1.gif','onclick','HMToggle(\'toggle\',\'TOGGLE0186A1\',\'TOGGLE0186A1_ICON\')');
HMInitToggle('TOGGLE0186A1','hm.type','dropdown','hm.state','0');
HMInitToggle('TOGGLE0186A2','hm.type','picture','hm.state','0','hm.src0','magenta_01_zoom50.png','hm.src1','magenta_01.png');
HMInitToggle('TOGGLE0186A3','hm.type','picture','hm.state','0','hm.src0','magenta_02_zoom50.png','hm.src1','magenta_02.png');
HMInitToggle('TOGGLE0186A4','hm.type','picture','hm.state','0','hm.src0','magenta_03_zoom50.png','hm.src1','magenta_03.png');
HMInitToggle('TOGGLE0186A5','hm.type','picture','hm.state','0','hm.src0','magenta_04_zoom50.png','hm.src1','magenta_04.png');
HMInitToggle('TOGGLE0186A6','hm.type','picture','hm.state','0','hm.src0','magenta_05_zoom50.png','hm.src1','magenta_05.png');
HMInitToggle('TOGGLE0186A7','hm.type','picture','hm.state','0','hm.src0','magenta_06_zoom50.png','hm.src1','magenta_06.png');

}
var checkTimer=setTimeout("HMInitToggleStates()", 0);
}
</script>
</body>
</html>
